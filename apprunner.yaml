# apprunner.yaml
version: 1.0
runtime: nodejs22

build:
  commands:
    pre-build:
      # Ensure pnpm is available in the managed runtime
      - corepack enable
      - corepack prepare pnpm@9 --activate
      - pnpm install --frozen-lockfile
      - npx prisma generate
    build:
      - pnpm build

run:
  pre-run:
    # Apply DB migrations on each deploy (safe for Prisma in prod)
    - npx prisma migrate deploy
  command: pnpm start
  network:
    # Next.js must listen on the same port App Runner probes
    port: 3000
